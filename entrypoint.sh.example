#!/bin/bash

set -e

# Replace these with your bot token and chat ID
BRANCH="production"

TELEGRAM_BOT_TOKEN="<YOUR_BOT_TOKEN>"
TELEGRAM_CHAT_ID="<YOUR_CHAT_ID>"

function send_telegram_alert {
    local message="$1"
    curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
    -d chat_id="$TELEGRAM_CHAT_ID" \
    -d text="$message"
}

function error_exit {
    local message="$1"
    send_telegram_alert "ðŸ”´ Deployment failed: $message"
    exit 1
}

echo "âœ… Deploying Application ..."

# Update codebase
if git pull origin $BRANCH; then
    echo "âœ… Codebase updated from $BRANCH."
else
    error_exit "ðŸš¨ Failed to update codebase."
fi

# NPM Install
if bun install; then
    echo "âœ… BUN Install"
else
    error_exit "ðŸš¨ Failed to run BUN Install."
fi

# NPM run Build
if vite build; then
    echo "âœ… Run vite build."
else
    error_exit "ðŸš¨ Failed to Build."
fi

# Send success alert
send_telegram_alert "ðŸŸ¢ Deployment succeeded. The application is now live."

echo "âœ… Application Deployed Successfully"
